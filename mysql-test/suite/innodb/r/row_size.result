call mtr.add_suppression("Cannot create the table `test1`.`t1` because the record size will exceed the maximum allowed size for a record.");
call mtr.add_suppression("Cannot alter the table `test1`.`t1` because the record size will exceed the maximum allowed size for a record on the index 'PRIMARY'.");
call mtr.add_suppression("Trying to add or drop column\\(s\\) in table 'test1/t1'.*ADD or DROP column with ALGORITHM = INSTANT is not allowed.");
CREATE DATABASE test1;
USE test1;
SET SESSION innodb_strict_mode=on;
CREATE TABLE `t1` (
`c1` varchar(255),
`c2` varchar(255),
`c3` varchar(255),
`c4` varchar(255),
`c5` varchar(255),
`c6` varchar(255),
`c7` varchar(255),
`c8` varchar(255),
`c9` varchar(255),
`c10` varchar(255),
`c11` varchar(255),
primary key (`c1`(40))
) ROW_FORMAT=COMPACT;
ERROR 42000: Row size too large (> 8126). Changing some columns to TEXT or BLOB or using ROW_FORMAT=DYNAMIC or ROW_FORMAT=COMPRESSED may help. In current row format, BLOB prefix of 768 bytes is stored inline.
SET SESSION innodb_strict_mode=off;
CREATE TABLE `t1` (
`c1` varchar(255),
`c2` varchar(255),
`c3` varchar(255),
`c4` varchar(255),
`c5` varchar(255),
`c6` varchar(255),
`c7` varchar(255),
`c8` varchar(255),
`c9` varchar(255),
`c10` varchar(255),
`c11` varchar(255),
primary key (`c1`(40))
) ROW_FORMAT=COMPACT;
Warnings:
Warning	139	Row size too large (> 8126). Changing some columns to TEXT or BLOB or using ROW_FORMAT=DYNAMIC or ROW_FORMAT=COMPRESSED may help. In current row format, BLOB prefix of 768 bytes is stored inline.
INSERT INTO test1.t1 SET c1="foobar";
SET SESSION innodb_strict_mode=on;
ALTER TABLE test1.t1 ADD COLUMN c12 varchar(255), ADD COLUMN c13 varchar(255);
ERROR 42000: Row size too large. The maximum row size for the used table type, not counting BLOBs, is 8126. This includes storage overhead, check the manual. You have to change some columns to TEXT or BLOBs
SET SESSION innodb_strict_mode=off;
ALTER TABLE test1.t1 ADD COLUMN c12 varchar(255), ADD COLUMN c13 varchar(255);
Warnings:
Warning	139	Row size too large (> 8126). Changing some columns to TEXT or BLOB or using ROW_FORMAT=DYNAMIC or ROW_FORMAT=COMPRESSED may help. In current row format, BLOB prefix of 768 bytes is stored inline.
Warning	139	Row size too large (> 8126). Changing some columns to TEXT or BLOB or using ROW_FORMAT=DYNAMIC or ROW_FORMAT=COMPRESSED may help. In current row format, BLOB prefix of 768 bytes is stored inline.
SET SESSION innodb_strict_mode=on;
ALTER TABLE test1.t1 DROP COLUMN c12;
ERROR 42000: Row size too large. The maximum row size for the used table type, not counting BLOBs, is 8126. This includes storage overhead, check the manual. You have to change some columns to TEXT or BLOBs
SET SESSION innodb_strict_mode=off;
ALTER TABLE test1.t1 DROP COLUMN c13;
Warnings:
Warning	139	Row size too large (> 8126). Changing some columns to TEXT or BLOB or using ROW_FORMAT=DYNAMIC or ROW_FORMAT=COMPRESSED may help. In current row format, BLOB prefix of 768 bytes is stored inline.
Warning	139	Row size too large (> 8126). Changing some columns to TEXT or BLOB or using ROW_FORMAT=DYNAMIC or ROW_FORMAT=COMPRESSED may help. In current row format, BLOB prefix of 768 bytes is stored inline.
ALTER TABLE test1.t1 ADD COLUMN c13 varchar(255), algorithm=instant;
ERROR HY000: Column can't be added or dropped with ALGORITHM=INSTANT as either max possible row size already crosses max permissible row size or may cross it after add. Try ALGORITHM=INPLACE/COPY.
ALTER TABLE test1.t1 DROP COLUMN c12, algorithm=instant;
ERROR HY000: Column can't be added or dropped with ALGORITHM=INSTANT as either max possible row size already crosses max permissible row size or may cross it after add. Try ALGORITHM=INPLACE/COPY.
# restart
SELECT * FROM test1.t1;
c1	c2	c3	c4	c5	c6	c7	c8	c9	c10	c11	c12
foobar	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL
Warnings:
Warning	139	Row size too large (> 8126). Changing some columns to TEXT or BLOB or using ROW_FORMAT=DYNAMIC or ROW_FORMAT=COMPRESSED may help. In current row format, BLOB prefix of 768 bytes is stored inline.
include/assert.inc [count in the error_log table should be same]
DROP DATABASE test1;
SET SESSION innodb_strict_mode = 1;
