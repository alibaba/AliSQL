--disable_warnings
--let $rpl_multi_source= 1
--let $rpl_topology= 1->3,2->3,3->4
--source include/rpl_init.inc
--enable_warnings

--echo # Prepare, InnoDB (server_1, server_2) -> DuckDB (server_3) -> DuckDB (server_4)
--connection server_1
--echo [connection server_1]
CREATE TABLE t1 (id INT PRIMARY KEY, c0 VARCHAR(20)) ENGINE = INNODB;

--connection server_2
--echo [connection server_2]
CREATE TABLE t2 (id INT PRIMARY KEY, c0 VARCHAR(20)) ENGINE = INNODB;

--let $sync_slave_connection= server_3
--source include/sync_slave_sql_with_master.inc
--let $sync_slave_connection= server_4
--source include/sync_slave_sql_with_master.inc

--echo # 1. Excute DML on server_1 and server_2
--connection server_1
--echo [connection server_1]
INSERT INTO t1 VALUES (1, 'abc');
--let $sync_slave_connection= server_3
--source include/sync_slave_sql_with_master.inc

--connection server_2
--echo [connection server_2]
INSERT INTO t2 VALUES (2, 'def');
--let $sync_slave_connection= server_3
--source include/sync_slave_sql_with_master.inc

--let $sync_slave_connection= server_4
--source include/sync_slave_sql_with_master.inc

--echo # 2. Excute DML on server_1, which has smaller sidno on server_4
--connection server_1
--echo [connection server_1]
UPDATE t1 SET c0 = 'xyz' WHERE id = 1;

--let $sync_slave_connection= server_3
--source include/sync_slave_sql_with_master.inc
--let $sync_slave_connection= server_4
--source include/sync_slave_sql_with_master.inc

--echo # 3. Check Data
--let $rpl_diff_statement= SELECT * FROM t1 ORDER BY id
--let $rpl_diff_servers=1,3,4
--let $rpl_skip_sync=1
--source include/rpl_diff.inc

--let $rpl_diff_statement= SELECT * FROM t2 ORDER BY id
--let $rpl_diff_servers=2,3,4
--let $rpl_skip_sync=1
--source include/rpl_diff.inc

--echo # Cleanup
--connection server_1
--echo [connection server_1]
DROP TABLE t1;

--connection server_2
--echo [connection server_2]
DROP TABLE t2;

--let $sync_slave_connection= server_3
--source include/sync_slave_sql_with_master.inc
--let $sync_slave_connection= server_4
--source include/sync_slave_sql_with_master.inc
--source include/rpl_end.inc
