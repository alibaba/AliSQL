--disable_query_log
--disable_result_log

--source include/rpl_connection_master.inc
DROP TABLE IF EXISTS t1, t2, t3, t4, t5, t6, t7, t8, t9, t10, t11;

# Single column
CREATE TABLE t1 (id INT KEY)
PARTITION BY RANGE COLUMNS (id) (
  PARTITION p0 VALUES LESS THAN (100),
  PARTITION p1 VALUES LESS THAN (1000),
  PARTITION p2 VALUES LESS THAN MAXVALUE
);
INSERT INTO t1 VALUES (10), (110), (1110);

CREATE TABLE t2 (id INT KEY)
PARTITION BY LIST (id) (
  PARTITION p0 VALUES IN (0, 1, 2, 3, 4),
  PARTITION p1 VALUES IN (5, 6, 7, 8, 9),
  PARTITION p2 VALUES in (10, 11, 12, 13, 14)
);
INSERT INTO t2 VALUES (0), (5), (10);

# Multiple columns
# TODO: multiple columns for range partition can not be supported by DuckDB.
CREATE TABLE t3 (a INT, b INT, c CHAR(2), PRIMARY KEY (a,b,c))
PARTITION BY LIST COLUMNS(a,b,c) (
  PARTITION p0 VALUES IN ((1, 1, 'a1'), (1, 1, 'a2'), (1, 1, 'a3')),
  PARTITION p1 VALUES IN ((1, 2, 'a1'), (1, 2, 'a2'), (1, 2, 'a3')),
  PARTITION p2 VALUES IN ((2, 1, 'a1'), (2, 1, 'a2'), (2, 1, 'a3'))
);
INSERT INTO t3 VALUES (1, 1, 'a1'), (1, 2, 'a2'), (2, 1, 'a3');

# Expression
CREATE TABLE t4 (id INT, a INT, PRIMARY KEY (id, a))
PARTITION BY RANGE (id + a) (
  PARTITION p0 VALUES LESS THAN (100),
  PARTITION p1 VALUES LESS THAN (10000),
  PARTITION p2 VALUES LESS THAN MAXVALUE
);
INSERT INTO t4 VALUES (1, 1), (100, 100), (10000, 10000);

CREATE TABLE t5 (id INT, a INT, PRIMARY KEY (id, a))
PARTITION BY LIST (id * a) (
  PARTITION p0 VALUES IN (2, 4, 6, 8),
  PARTITION p1 VALUES IN (10, 12, 14, 16),
  PARTITION p2 VALUES IN (20, 24, 28, 32)
);
INSERT INTO t5 VALUES (2, 1), (4, 3), (7, 4);

# Function
CREATE TABLE t6 (c TIMESTAMP KEY)
PARTITION BY RANGE (UNIX_TIMESTAMP(c)) (
  PARTITION p0 VALUES LESS THAN (1483218000),
  PARTITION p1 VALUES LESS THAN (1514754000),
  PARTITION p2 VALUES LESS THAN (MAXVALUE)
);
INSERT INTO t6 VALUES ('2016-01-01 00:00:00'), ('2017-01-01 00:00:00'), ('2025-01-01 00:00:00');

CREATE TABLE t7 (sale_date DATE KEY)
PARTITION BY LIST (YEAR(sale_date)) (
  PARTITION p0 VALUES IN (1995, 1996, 1997),
  PARTITION p1 VALUES IN (1998, 1999, 2000),
  PARTITION p2 VALUES IN (2001, 2002, 2003)
);
INSERT INTO t7 VALUES ('1995-01-01 00:00:00'), ('1998-01-01 00:00:00'), ('2001-01-01 00:00:00');

# Subpartition
CREATE TABLE t8 (i INTEGER KEY)
PARTITION BY RANGE(i) PARTITIONS 3 SUBPARTITION BY HASH(i) (
  PARTITION p0 VALUES LESS THAN(100) (SUBPARTITION sp00, SUBPARTITION sp01),
  PARTITION p1 VALUES LESS THAN(200) (SUBPARTITION sp10, SUBPARTITION sp11),
  PARTITION p2 VALUES LESS THAN MAXVALUE (SUBPARTITION sp20, SUBPARTITION sp21)
);
INSERT INTO t8 VALUES (0), (1), (100), (101), (200), (201);

CREATE TABLE t9 (i INTEGER KEY)
PARTITION BY LIST(MOD(i, 2)) SUBPARTITION BY KEY(i) (
  PARTITION p0 VALUES IN (-1) (SUBPARTITION sp00, SUBPARTITION sp01),
  PARTITION p1 VALUES IN (0) (SUBPARTITION sp10, SUBPARTITION sp11),
  PARTITION p2 VALUES IN (1) (SUBPARTITION sp20, SUBPARTITION sp21)
);
INSERT INTO t9 VALUES (-1), (0), (1), (-3), (2), (3);

CREATE TABLE t10 (f_int1 INT KEY)
PARTITION BY LIST(ABS(MOD(f_int1,2))) SUBPARTITION BY HASH(f_int1) (
  PARTITION p0 VALUES IN (0) (SUBPARTITION sp00, SUBPARTITION sp01),
  PARTITION p1 VALUES IN (1) (SUBPARTITION sp10, SUBPARTITION sp11),
  PARTITION p2 VALUES IN (NULL) (SUBPARTITION sp20, SUBPARTITION sp21)
);
INSERT INTO t10 VALUES (-1), (0), (1), (-3), (2), (3);

--let $num1 = `SELECT COUNT(*) FROM information_schema.tables WHERE ENGINE = 'InnoDB' AND TABLE_SCHEMA = 'test'`

--source include/rpl_sync.inc
--source include/rpl_connection_slave.inc
--let $num2 = `SELECT COUNT(*) FROM information_schema.tables WHERE ENGINE = 'DuckDB' AND TABLE_SCHEMA = 'test'`

--let $assert_cond = "$num1" = "$num2"
--let $assert_text= num is the same
--source include/assert.inc

--enable_query_log
--enable_result_log
