SET GLOBAL vidx_disabled = OFF;
SET transaction_isolation = 'READ-COMMITTED';
# 1. SUPPORT about VECTOR functions
SELECT VECTOR_DIM(VEC_FROMTEXT("[1,2,3,4,5]"));
VECTOR_DIM(VEC_FROMTEXT("[1,2,3,4,5]"))
5
SELECT VEC_TOTEXT(x'e360d63ebe554f3fcdbc523f4522193f5236083d');
VEC_TOTEXT(x'e360d63ebe554f3fcdbc523f4522193f5236083d')
[0.418708,0.809902,0.823193,0.598179,0.0332549]
SELECT VEC_TOTEXT("abcd");
VEC_TOTEXT("abcd")
[1.6778e22]
SELECT VEC_TOTEXT(VEC_FROMTEXT("[1,2,3,4,5]"));
VEC_TOTEXT(VEC_FROMTEXT("[1,2,3,4,5]"))
[1,2,3,4,5]
SELECT VEC_DISTANCE_EUCLIDEAN(VEC_FROMTEXT("[1,2,3,4,5]"), VEC_FROMTEXT("[1,2,3,4,5]"));
VEC_DISTANCE_EUCLIDEAN(VEC_FROMTEXT("[1,2,3,4,5]"), VEC_FROMTEXT("[1,2,3,4,5]"))
0
SELECT VEC_DISTANCE_EUCLIDEAN(VEC_FROMTEXT("[1,2,3,4,5]"), VEC_FROMTEXT("[1,2,3,4,5.1]"));
VEC_DISTANCE_EUCLIDEAN(VEC_FROMTEXT("[1,2,3,4,5]"), VEC_FROMTEXT("[1,2,3,4,5.1]"))
0.09999990463256836
SELECT VEC_DISTANCE_COSINE(VEC_FROMTEXT("[1,2,3,4,5]"), VEC_FROMTEXT("[1,2,3,4,5]"));
VEC_DISTANCE_COSINE(VEC_FROMTEXT("[1,2,3,4,5]"), VEC_FROMTEXT("[1,2,3,4,5]"))
0
SELECT VEC_DISTANCE_COSINE(VEC_FROMTEXT("[1,2,3,4,5]"), VEC_FROMTEXT("[1,2,3,4,5.1]"));
VEC_DISTANCE_COSINE(VEC_FROMTEXT("[1,2,3,4,5]"), VEC_FROMTEXT("[1,2,3,4,5.1]"))
0.00004867880623027343
# NULL, empty vector is allowed in VEC_TOTEXT and VECTOR_DIM
SELECT VEC_TOTEXT(x'');
VEC_TOTEXT(x'')

SELECT VEC_TOTEXT(NULL);
VEC_TOTEXT(NULL)
NULL
SELECT VECTOR_DIM(x'');
VECTOR_DIM(x'')
0
SELECT VECTOR_DIM(NULL);
VECTOR_DIM(NULL)
NULL
# NULL vector is allowed in VEC_FROMTEXT
SELECT VEC_FROMTEXT(NULL);
VEC_FROMTEXT(NULL)
NULL

# 3. NONSUPPORT about VECTOR functions
# The length of arguments should be able to converted to a vector dimension
SELECT VEC_TOTEXT("abc");
ERROR HY000: Invalid binary vector format. Must use IEEE standard float representation in little-endian format. Use VEC_FromText() to generate it.
# Invalid binary format
SELECT VEC_FROMTEXT("1,2,3,4,5]");
ERROR HY000: Data cannot be converted to a valid vector: '1,2,3,4,5]'
SELECT VEC_FROMTEXT("");
ERROR HY000: Data cannot be converted to a valid vector: ''
# The number of arguments is not correct
SELECT VEC_TOTEXT();
ERROR 42000: Incorrect parameter count in the call to native function 'VEC_TOTEXT'
SELECT VECTOR_DIM();
ERROR 42000: Incorrect parameter count in the call to native function 'VECTOR_DIM'
SELECT VECTOR_DIM(VEC_FROMTEXT("[1,2,3,4,5]"), VEC_FROMTEXT("[1,2,3,4,5]"));
ERROR 42000: Incorrect parameter count in the call to native function 'VECTOR_DIM'
# The distance tween two vectors having different dimensions should be NULL
SELECT VEC_DISTANCE_EUCLIDEAN(VEC_FROMTEXT("[1,2,3,4,5]"), VEC_FROMTEXT("[1,2,3,4]"));
VEC_DISTANCE_EUCLIDEAN(VEC_FROMTEXT("[1,2,3,4,5]"), VEC_FROMTEXT("[1,2,3,4]"))
NULL
SELECT VEC_DISTANCE_EUCLIDEAN(VEC_FROMTEXT("[1,2,3,4,5]"), NULL);
VEC_DISTANCE_EUCLIDEAN(VEC_FROMTEXT("[1,2,3,4,5]"), NULL)
NULL
SELECT VEC_DISTANCE_COSINE(VEC_FROMTEXT("[1,2,3,4,5]"), VEC_FROMTEXT("[1,2,3,4,5,6]"));
VEC_DISTANCE_COSINE(VEC_FROMTEXT("[1,2,3,4,5]"), VEC_FROMTEXT("[1,2,3,4,5,6]"))
NULL
SELECT VEC_DISTANCE_COSINE(NULL, VEC_FROMTEXT("[1,2,3,4,5,6]"));
VEC_DISTANCE_COSINE(NULL, VEC_FROMTEXT("[1,2,3,4,5,6]"))
NULL
SELECT VEC_DISTANCE_COSINE(NULL, NULL);
VEC_DISTANCE_COSINE(NULL, NULL)
NULL

# 4. DML using vector functions
CREATE TABLE t1 (
id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
v VECTOR(5)
);
INSERT INTO t1(v) VALUES (VEC_FROMTEXT("[1,2,3,4,5]"));
INSERT INTO t1(v) VALUES (TO_VECTOR("[1.1,2.1,3.1,4.1,5.1]"));
INSERT INTO t1(v) VALUES (STRING_TO_VECTOR("[1.2,2.2,3.2,4.2,5.2]"));
INSERT INTO t1(v) VALUES (x'e360d63ebe554f3fcdbc523f4522193f5236083d');
SELECT id, VEC_TOTEXT(v) FROM t1;
id	VEC_TOTEXT(v)
1	[1,2,3,4,5]
2	[1.1,2.1,3.1,4.1,5.1]
3	[1.2,2.2,3.2,4.2,5.2]
4	[0.418708,0.809902,0.823193,0.598179,0.0332549]
SELECT VECTOR_DIM(v) FROM t1;
VECTOR_DIM(v)
5
5
5
5
SELECT VEC_TOTEXT(v) FROM t1;
VEC_TOTEXT(v)
[1,2,3,4,5]
[1.1,2.1,3.1,4.1,5.1]
[1.2,2.2,3.2,4.2,5.2]
[0.418708,0.809902,0.823193,0.598179,0.0332549]
SELECT FROM_VECTOR(v) FROM t1;
FROM_VECTOR(v)
[1,2,3,4,5]
[1.1,2.1,3.1,4.1,5.1]
[1.2,2.2,3.2,4.2,5.2]
[0.418708,0.809902,0.823193,0.598179,0.0332549]
SELECT VECTOR_TO_STRING(v) FROM t1;
VECTOR_TO_STRING(v)
[1,2,3,4,5]
[1.1,2.1,3.1,4.1,5.1]
[1.2,2.2,3.2,4.2,5.2]
[0.418708,0.809902,0.823193,0.598179,0.0332549]
SELECT id, VEC_DISTANCE_EUCLIDEAN(v, VEC_FROMTEXT("[1,2,3,4,5]")) FROM t1;
id	VEC_DISTANCE_EUCLIDEAN(v, VEC_FROMTEXT("[1,2,3,4,5]"))
1	0
2	0.2236066378139594
3	0.4472134888760042
4	6.537098835577236
SELECT id, VEC_DISTANCE_COSINE(v, VEC_FROMTEXT("[1,2,3,4,5]")) FROM t1;
id	VEC_DISTANCE_COSINE(v, VEC_FROMTEXT("[1,2,3,4,5]"))
1	0
2	0.00007830157192822984
3	0.00029710017677209155
4	0.3027471560934656
SELECT id FROM t1 ORDER BY VEC_DISTANCE_EUCLIDEAN(v, VEC_FROMTEXT("[1,2,3,4,5]"));
id
1
2
3
4
DROP TABLE t1;
SET GLOBAL vidx_disabled = ON;
