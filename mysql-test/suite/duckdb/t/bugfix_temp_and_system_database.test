# DuckDB has default databases named 'temp' and 'system', if we try to create
# schema named 'temp' or 'system', we get an error.

--echo #
--echo # TEST FOR `temp` and `system`
--echo #
CALL dbms_duckdb.query("SELECT * FROM information_schema.schemata WHERE catalog_name in (\"system\", \"temp\") or schema_name in (\"system\", \"temp\")");

# temp schema
CREATE DATABASE `temp`;
USE `temp`;
CREATE TABLE t1(a INT KEY) ENGINE = DuckDB;
CALL dbms_duckdb.query("SELECT * FROM information_schema.schemata WHERE catalog_name in (\"system\", \"temp\") or schema_name in (\"system\", \"temp\")");

RENAME TABLE t1 TO t2;
ALTER TABLE t2 RENAME TO t1;
ALTER TABLE t1 ADD COLUMN b INT;
TRUNCATE TABLE t1;

# TODO: DML on temp schema may be failed.
USE `test`;
SET GLOBAL duckdb_dml_in_batch = ON;
INSERT INTO temp.t1 VALUES (1, 1), (2, 1), (3, 1);
SET GLOBAL duckdb_dml_in_batch = OFF;
--error ER_DUCKDB_QUERY_ERROR
INSERT INTO temp.t1 VALUES (4, 1);
--error ER_DUCKDB_CLIENT
SELECT * FROM temp.t1;
--error ER_DUCKDB_CLIENT
UPDATE temp.t1 SET b = 1;
--error ER_DUCKDB_CLIENT
DELETE FROM temp.t1;

USE `temp`;
DROP TABLE t1;

# system schema
CREATE DATABASE `system`;
USE `system`;
CREATE TABLE t1(a INT KEY) ENGINE = DuckDB;
CALL dbms_duckdb.query("SELECT * FROM information_schema.schemata WHERE catalog_name in (\"system\", \"temp\") or schema_name in (\"system\", \"temp\")");

RENAME TABLE t1 TO t2;
ALTER TABLE t2 RENAME TO t1;
ALTER TABLE t1 ADD COLUMN b INT;
TRUNCATE TABLE t1;

# TODO: DML on system schema may be failed.
USE `test`;
SET GLOBAL duckdb_dml_in_batch = ON;
INSERT INTO system.t1 VALUES (1, 1), (2, 1), (3, 1);
SET GLOBAL duckdb_dml_in_batch = OFF;
--error ER_DUCKDB_QUERY_ERROR
INSERT INTO system.t1 VALUES (4, 1);
--error ER_DUCKDB_CLIENT
SELECT * FROM system.t1;
--error ER_DUCKDB_CLIENT
UPDATE system.t1 SET b = 1;
--error ER_DUCKDB_CLIENT
DELETE FROM system.t1;

USE `system`;
DROP TABLE t1;

# Duckdb not support database name with `
--error ER_DUCKDB_CLIENT
CREATE DATABASE `d``b`;

--echo #
--echo # CLEANUP
--echo #
SET GLOBAL duckdb_dml_in_batch = default;
DROP DATABASE `temp`;
DROP DATABASE `system`;
CALL dbms_duckdb.query("SELECT * FROM information_schema.schemata WHERE catalog_name in (\"system\", \"temp\") or schema_name in (\"system\", \"temp\")");
