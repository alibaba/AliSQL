--source include/master-slave.inc
--source include/have_binlog_format_row.inc

--echo #
--echo # 1) CREATE INNODB TABLE IN MASTER, THE TABLE IN SLAVE WILL BE CONVERTED TO DUCKDB
--echo #
--source include/rpl_connection_master.inc
CREATE TABLE t1 (id INT, name VARCHAR(255), PRIMARY KEY (id)) ENGINE = InnoDB;
INSERT INTO t1 VALUES (1, 'one');

SHOW CREATE TABLE t1;
SELECT * FROM t1;

--source include/rpl_sync.inc
--source include/rpl_connection_slave.inc
SHOW CREATE TABLE t1;
SELECT * FROM t1;


--echo #
--echo # 2) CREATE INNODB TABLE WITHOUT PK IN MASTER, SLAVE FAILS TO CONVERT TO DUCKDB
--echo #
--source include/rpl_connection_master.inc
SET GTID_NEXT = 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:1';
CREATE TABLE t2 (id INT, name VARCHAR(255)) ENGINE = InnoDB;
SET GTID_NEXT = 'AUTOMATIC';

SHOW CREATE TABLE t1;
SELECT * FROM t1;


--source include/rpl_connection_slave.inc
let $slave_param= Last_SQL_Errno;
let $slave_param_comparison= =;
let $slave_param_value= 1173;
--source include/wait_for_slave_param.inc

SET GTID_NEXT = 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:1';
BEGIN;
COMMIT;
SET GTID_NEXT = 'AUTOMATIC';

--source include/start_slave_sql.inc
--source include/rpl_sync.inc

--error ER_NO_SUCH_TABLE
SHOW CREATE TABLE t2;

--disable_query_log
CALL mtr.add_suppression("Error_code: MY-001173");
CALL mtr.add_suppression("Error_code: MY-001756");
--enable_query_log


--echo #
--echo # 3) CLEANUP
--echo #
--source include/rpl_connection_master.inc
DROP TABLE IF EXISTS t1, t2;
--source include/rpl_sync.inc
--source include/rpl_end.inc
