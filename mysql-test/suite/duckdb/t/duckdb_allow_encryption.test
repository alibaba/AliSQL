
--disable_warnings
DROP DATABASE IF EXISTS encryption_test;
--enable_warnings
CREATE DATABASE encryption_test;
USE encryption_test;

--echo #
--echo # Test: create duckdb table with encryption option
--echo #
CREATE TABLE string_table (
  id INT PRIMARY KEY,
  bool_field BOOLEAN,
  decimal_field DECIMAL(10,2),
  enum_field ENUM('small', 'medium', 'large'),
  set_field SET('red', 'green', 'blue'),
  varchar_field VARCHAR(255),
  json_field JSON ,
  text_field TEXT,
  new_decimal_field DECIMAL(20,6)
) ENGINE=DuckDB ENCRYPTION = 'Y';
INSERT INTO string_table VALUES (1, TRUE, 123.45, 'small', 'red,green', 'varchar_sample','{"name": "Alice", "age": 30}', 'This is a sample text.', 123456.789012);
INSERT INTO string_table VALUES (2, NULL, NULL, NULL, NULL, NULL, NULL,NULL,NULL);
INSERT INTO string_table VALUES (3, FALSE, 100.00, 'medium', 'red,blue', 'varchar_final', '{"animal": "dog", "legs": 4}', 'End of this test text.', 778899.001122);
SHOW CREATE TABLE string_table;
CHECKSUM TABLE string_table;

--echo #
--echo # alter table to innodb and check whether innodb is encrypted
--echo #
ALTER TABLE string_table ENGINE = InnoDB;
SHOW CREATE TABLE string_table;
CHECKSUM TABLE string_table;

--echo #
--echo # Test: create innodb table with encryption option
--echo #
CREATE TABLE blob_table (
  id INT PRIMARY KEY,
  tiny_blob_field TINYBLOB,
  medium_blob_field MEDIUMBLOB,
  long_blob_field LONGBLOB,
  blob_field BLOB,
  bit_field BIT(64)
) ENGINE=InnoDB ENCRYPTION = 'Y';
INSERT INTO blob_table VALUES (1, 'tinyblob_data', 'mediumblob_data', 'longblob_data', 'blob_data', b'00000001');
INSERT INTO blob_table VALUES (2, NULL, NULL, 'longblob_data3', NULL, b'00000010');
INSERT INTO blob_table VALUES (3, 'tinyblob_data4', 'mediumblob_data4', NULL, 'blob_data2', NULL);
SHOW CREATE TABLE blob_table;
CHECKSUM TABLE blob_table;

--echo #
--echo # Test: alter table to duckdb and check whether duckdb is encrypted
--echo #
ALTER TABLE blob_table ENGINE = DuckDB;
SHOW CREATE TABLE blob_table;
CHECKSUM TABLE blob_table;


DROP DATABASE encryption_test;