--source include/master-slave.inc
--source include/have_binlog_format_row.inc

--echo #########################################################################
--echo # 1. CREATE TABLE WITH DIFFERENT ROW_FORMAT
--echo #########################################################################
--source include/rpl_connection_master.inc
CREATE TABLE t1 (id INT KEY, b int) ROW_FORMAT = DEFAULT;
CREATE TABLE t2 (id INT KEY, b int) ROW_FORMAT = DYNAMIC;
CREATE TABLE t3 (id INT KEY, b int) ROW_FORMAT = REDUNDANT;
CREATE TABLE t4 (id INT KEY, b int) ROW_FORMAT = COMPACT;
CREATE TABLE t5 (id INT KEY, b int) ROW_FORMAT = COMPRESSED;

--source include/rpl_sync.inc
--source include/rpl_connection_slave.inc
SET GLOBAL innodb_default_row_format = DYNAMIC;
--source include/rpl_connection_master.inc
SET GLOBAL innodb_default_row_format = DYNAMIC;
CREATE TABLE t6 (id INT KEY, b int);

--source include/rpl_sync.inc
--source include/rpl_connection_slave.inc
SET GLOBAL innodb_default_row_format = REDUNDANT;
--source include/rpl_connection_master.inc
SET GLOBAL innodb_default_row_format = REDUNDANT;
CREATE TABLE t7 (id INT KEY, b int);

--source include/rpl_sync.inc
--source include/rpl_connection_slave.inc
SET GLOBAL innodb_default_row_format = COMPACT;
--source include/rpl_connection_master.inc
SET GLOBAL innodb_default_row_format = COMPACT;
CREATE TABLE t8 (id INT KEY, b int);

--source include/rpl_sync.inc
--source include/rpl_connection_slave.inc
SET GLOBAL innodb_default_row_format = default;
--source include/rpl_connection_master.inc
SET GLOBAL innodb_default_row_format = default;


--echo #########################################################################
--echo # 2. CHECK ROW_FORMAT IN INNODB AND DUCKDB
--echo #########################################################################
--source include/rpl_sync.inc
--source include/rpl_connection_slave.inc
--let $n = 1
while ($n < 9)
{
  --source include/rpl_connection_master.inc
  --eval SHOW CREATE TABLE t$n
  --let $row_format_innodb = query_get_value(SELECT ROW_FORMAT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 't$n', ROW_FORMAT, 1)
  --source include/rpl_connection_slave.inc
  --eval SHOW CREATE TABLE t$n
  --let $row_format_duckdb = query_get_value(SELECT ROW_FORMAT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 't$n', ROW_FORMAT, 1)

  --let $assert_cond= "$row_format_innodb" = "$row_format_duckdb"
  --let $assert_text= ROW_FORMAT of t$n is the same
  --source include/assert.inc
  --inc $n
}


--echo #########################################################################
--echo # 3. Test Cleanup
--echo #########################################################################
--source include/rpl_connection_master.inc
DROP TABLE t1, t2, t3, t4, t5, t6, t7, t8;
--source include/rpl_sync.inc
--source include/rpl_end.inc
