--source include/master-slave.inc
--source include/have_debug.inc
--source include/have_binlog_format_row.inc

--echo ###########################################################################
--echo # Prepare
--echo ###########################################################################
--source include/rpl_connection_master.inc
CREATE TABLE t1 (
    id BIGINT AUTO_INCREMENT NOT NULL,
    c0 DECIMAL(38, 13) DEFAULT 1,
    c1 DECIMAL(18, 13) DEFAULT 1,
    PRIMARY KEY(id)
) ENGINE=InnoDB;
SHOW CREATE TABLE t1;

--source include/rpl_sync.inc
--source include/rpl_connection_slave.inc
ALTER TABLE t1 ENGINE=DuckDB;
SHOW CREATE TABLE t1;

--echo ###########################################################################
--echo # Insert
--echo ###########################################################################
--source include/rpl_connection_master.inc

--echo # Test zero
INSERT INTO t1 (c0, c1) VALUES ('0', '0');
INSERT INTO t1 (c0, c1) VALUES ('0000.000000', '0000.000000');
INSERT INTO t1 (c0, c1) VALUES ('-0.0', '-0.0');
INSERT INTO t1 (c0, c1) VALUES ('-0', '-0');
INSERT INTO t1 (c0, c1) VALUES ('+0', '+0');

--echo # Test short decimal
INSERT INTO t1 (c0, c1) VALUES ('12.55', '12.55');
INSERT INTO t1 (c0, c1) VALUES ('4654563', '4563');
INSERT INTO t1 (c0, c1) VALUES ('-0.5444556', '-0.5444556');
INSERT INTO t1 (c0, c1) VALUES ('+23423.1111', '+23423.1111');
INSERT INTO t1 (c0, c1) VALUES ('-1', '-1');
INSERT INTO t1 (c0, c1) VALUES ('0002.7831', '0002.7831');

--echo # Test long decimal
INSERT INTO t1 (c0, c1) VALUES ('1564615522.33333347', '15522.33333347');
INSERT INTO t1 (c0, c1) VALUES ('-275923887532.3245523322', '-87532.3245523322');
INSERT INTO t1 (c0, c1) VALUES ('9999999999999999999999999.9999999999999', '99999.9999999999999');
INSERT INTO t1 (c0, c1) VALUES ('-9999999999999999999999999.9999999999999', '-99999.9999999999999');
INSERT INTO t1 (c0, c1) VALUES ('+0.0000000000001', '+0.0000000000001');
INSERT INTO t1 (c0, c1) VALUES ('1234567891011121314151617.1110987654321', '51617.1110987654321');
INSERT INTO t1 (c0, c1) VALUES ('9853424411255114773698212.0005445127236', '98212.0005445127236');
INSERT INTO t1 (c0, c1) VALUES ('-6541354789511459491453546.9881741477992', '-53546.9881741477992');
INSERT INTO t1 (c0, c1) VALUES ('-0.4478451545477', '-0.4478451545477');
INSERT INTO t1 (c0, c1) VALUES ('8771134545474121541247833', '47833');

--echo # Test truncated decimal
INSERT INTO t1 (c0, c1) VALUES ('0.00000000000001', '0.00000000000001');
INSERT INTO t1 (c0, c1) VALUES ('-0.00000000000001', '-0.00000000000001');
INSERT INTO t1 (c0, c1) VALUES ('9999999999999999999999999.99999999999994', '99999.99999999999994');
INSERT INTO t1 (c0, c1) VALUES ('-9999999999999999999999999.99999999999994', '-99999.99999999999994');

--echo # Test overflow decimal
--error ER_WARN_DATA_OUT_OF_RANGE
INSERT INTO t1 (c0) VALUES ('9999999999999999999999999.99999999999995');
--error ER_WARN_DATA_OUT_OF_RANGE
INSERT INTO t1 (c0) VALUES ('-9999999999999999999999999.99999999999995');
--error ER_WARN_DATA_OUT_OF_RANGE
INSERT INTO t1 (c0) VALUES ('10000000000000000000000000');
--error ER_WARN_DATA_OUT_OF_RANGE
INSERT INTO t1 (c0) VALUES ('-10000000000000000000000000');
--error ER_WARN_DATA_OUT_OF_RANGE
INSERT INTO t1 (c1) VALUES ('99999.99999999999995');
--error ER_WARN_DATA_OUT_OF_RANGE
INSERT INTO t1 (c1) VALUES ('-99999.99999999999995');
--error ER_WARN_DATA_OUT_OF_RANGE
INSERT INTO t1 (c1) VALUES ('100000');
--error ER_WARN_DATA_OUT_OF_RANGE
INSERT INTO t1 (c1) VALUES ('-100000');

SELECT * FROM t1 ORDER BY id;

--echo ###########################################################################
--echo # Check
--echo ###########################################################################
--source include/rpl_sync.inc
--let $rpl_diff_statement = SELECT id, c0 FROM test.t1 ORDER BY id;
--source include/rpl_diff.inc

--let $assert_file = $MYSQLTEST_VARDIR/log/mysqld.2.err
--let $assert_text = Check DML SQL is not executed
--let $assert_select = duckdb_print_dml
--let $assert_count = 0
--source include/assert_grep.inc

--echo ###########################################################################
--echo # Cleanup
--echo ###########################################################################
--source include/rpl_connection_master.inc
DROP TABLE t1;
--source include/rpl_sync.inc
--source include/rpl_end.inc
