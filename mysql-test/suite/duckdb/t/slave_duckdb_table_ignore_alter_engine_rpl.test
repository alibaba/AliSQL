--source include/master-slave.inc

--echo #
--echo # Test: create tables in master
--echo #
--disable_warnings
DROP DATABASE IF EXISTS alter_test;
--enable_warnings
CREATE DATABASE alter_test;
USE alter_test;
CREATE TABLE t1 (id int PRIMARY KEY, name varchar(255), f float, d double) ENGINE = InnoDB;
CREATE TABLE t2 (id int PRIMARY KEY, name varchar(255), f float, d double) ENGINE = InnoDB;
CREATE TABLE t3 (id int PRIMARY KEY, name varchar(255), f float, d double) ENGINE = InnoDB;
INSERT INTO t1 VALUES (1, 'test', 1.1, 1.2);
INSERT INTO t3 VALUES (2, 'test2', 2.1, 2.2);
INSERT INTO t3 VALUES (3, 'test3', 3.1, 3.2);

--echo #
--echo #check initial table info
--echo #
SHOW CREATE TABLE alter_test.t1;
--source include/rpl_sync.inc
--source include/rpl_connection_slave.inc
SHOW CREATE TABLE alter_test.t1;   

--echo #
--echo # alter table engine to innodb, slave node should not change
--echo #
--source include/rpl_connection_master.inc
ALTER TABLE alter_test.t1 ENGINE = InnoDB;
SHOW CREATE TABLE alter_test.t1;
--source include/rpl_sync.inc
--source include/rpl_connection_slave.inc
SHOW CREATE TABLE alter_test.t1;

--source include/rpl_connection_master.inc
ALTER TABLE alter_test.t1 ENGINE = InnoDB;
SHOW CREATE TABLE alter_test.t1;
--source include/rpl_sync.inc
--source include/rpl_connection_slave.inc
SHOW CREATE TABLE alter_test.t1;


--echo #
--echo #check initial table info
--echo #
--source include/rpl_connection_master.inc
SHOW CREATE TABLE alter_test.t2;
--source include/rpl_sync.inc
--source include/rpl_connection_slave.inc
SHOW CREATE TABLE alter_test.t2; 

--echo #
--echo # alter table engine to myisam/duckdb, slave node should change
--echo #
--source include/rpl_connection_master.inc
ALTER TABLE alter_test.t2 ENGINE = MyISAM;
SHOW CREATE TABLE alter_test.t2;
--source include/rpl_sync.inc
--source include/rpl_connection_slave.inc
SHOW CREATE TABLE alter_test.t2;

--source include/rpl_connection_master.inc
ALTER TABLE alter_test.t2 ENGINE = DuckDB;
SHOW CREATE TABLE alter_test.t2;
--source include/rpl_sync.inc
--source include/rpl_connection_slave.inc
SHOW CREATE TABLE alter_test.t2;


--echo #check initial table info
--echo #
--source include/rpl_connection_master.inc
SHOW CREATE TABLE alter_test.t3;
--source include/rpl_sync.inc
--source include/rpl_connection_slave.inc
SHOW CREATE TABLE alter_test.t3; 

--echo #
--echo # alter table engine to innodb and add column, slave node should ignore "alter engine" but execute "add column"
--echo #
--source include/rpl_connection_master.inc
ALTER TABLE alter_test.t3 ADD COLUMN b INT, ENGINE = InnoDB;
SHOW CREATE TABLE alter_test.t3;
--source include/rpl_sync.inc
--source include/rpl_connection_slave.inc
SHOW CREATE TABLE alter_test.t3; 


--echo #
--echo # CLEANUP
--echo #
--source include/rpl_connection_master.inc
DROP DATABASE IF EXISTS alter_test;
--source include/rpl_sync.inc
--source include/rpl_end.inc
