--echo #
--echo # check collation config when execute
--echo #

# Test 1. SELECT 'a' = 'A'
# a. duckdb: uses the default_collation configuration of the session variable
# b. mysql: uses the collation_connection configuration of the sesison variable

# Test 2. SELECT col = 'a' 
# a. duckdb: uses the collate defined by the column. If the column attribute is not configured, use the session default_collation configuration;
# b. mysql: uses the collate defined by the column. If the column attribute is not configured, use the collate of the database;

# For 2 we must set collation for duckdb column during create table and alter table

CREATE TABLE t_duckdb  (a varchar(32) PRIMARY KEY, b varchar(32), c varchar(32)) engine=duckdb;
CREATE TABLE t_innodb  (a varchar(32) PRIMARY KEY, b varchar(32), c varchar(32)) engine=innodb;

INSERT INTO t_duckdb VALUES ('a', 'A', '치');
INSERT INTO t_innodb VALUES ('a', 'A', '치');

--echo # 1.1 Test for utf8mb4

SET NAMES 'utf8mb4' COLLATE 'utf8mb4_0900_ai_ci';
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_duckdb;
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_innodb;

SET NAMES 'utf8mb4' COLLATE 'utf8mb4_0900_as_ci';
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_duckdb;
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_innodb;

SET NAMES 'utf8mb4' COLLATE 'utf8mb4_0900_as_cs';
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_duckdb;
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_innodb;

SET NAMES 'utf8mb4' COLLATE 'utf8mb4_0900_bin';
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_duckdb;
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_innodb;

SET NAMES 'utf8mb4' COLLATE 'utf8mb4_general_ci';
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_duckdb;
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_innodb;

SET NAMES 'utf8mb4' COLLATE 'utf8mb4_unicode_ci';
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_duckdb;
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_innodb;

SET NAMES 'utf8mb4' COLLATE 'utf8mb4_unicode_520_ci';
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_duckdb;
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_innodb;

SET NAMES 'utf8mb4' COLLATE 'utf8mb4_bin';
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_duckdb;
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_innodb;

SET NAMES 'utf8mb4' COLLATE 'utf8mb4_zh_0900_as_cs';
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_duckdb;
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_innodb;

SET NAMES 'utf8mb4' COLLATE 'utf8mb4_ja_0900_as_cs_ks';
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_duckdb;
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_innodb;

--echo # 1.2 Test for utf8mb3
--disable_warnings

SET NAMES 'utf8mb3' COLLATE 'utf8mb3_general_ci';
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_duckdb;
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_innodb;

SET NAMES 'utf8mb3' COLLATE 'utf8mb3_general_mysql500_ci';
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_duckdb;
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_innodb;

SET NAMES 'utf8mb3' COLLATE 'utf8mb3_bin';
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_duckdb;
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_innodb;

SET NAMES 'utf8mb3' COLLATE 'utf8mb3_tolower_ci';
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_duckdb;
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_innodb;

SET NAMES 'utf8mb3' COLLATE 'utf8mb3_unicode_ci';
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_duckdb;
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_innodb;

SET NAMES 'utf8mb3' COLLATE 'utf8mb3_unicode_520_ci';
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_duckdb;
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_innodb;

SET NAMES 'utf8mb3' COLLATE 'utf8mb3_swedish_ci';
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_duckdb;
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_innodb;

SET NAMES 'utf8' COLLATE 'utf8_general_ci';
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_duckdb;
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_innodb;

SET NAMES 'utf8' COLLATE 'utf8_bin';
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_duckdb;
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_innodb;

SET NAMES 'utf8' COLLATE 'utf8_tolower_ci';
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_duckdb;
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_innodb;

--enable_warnings

--echo # 1.3 Test for latin1
SET NAMES 'latin1' COLLATE 'latin1_general_ci';
#--warning 7580
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_duckdb;
SELECT 'a'='치' AS ai, 'a'='A' AS ci, 'A'='치' AS ai_ci FROM t_innodb;

SET NAMES 'utf8mb4';
DROP TABLE t_duckdb, t_innodb;

--echo #
--echo # Test 2. SELECT col = 'a'
--echo #

--echo # 2.1 define collation for table with utf8mb4
CREATE TABLE t_duckdb (id INT PRIMARY KEY, a varchar(32), b varchar(32) COLLATE utf8mb4_general_ci, c varchar(32) COLLATE utf8mb4_0900_as_cs, d varchar(32) COLLATE utf8mb4_0900_as_ci) engine=duckdb CHARSET=utf8mb4 COLLATE=utf8mb4_0900_as_cs;
CREATE TABLE t_innodb (id INT PRIMARY KEY, a varchar(32), b varchar(32) COLLATE utf8mb4_general_ci, c varchar(32) COLLATE utf8mb4_0900_as_cs, d varchar(32) COLLATE utf8mb4_0900_as_ci) engine=innodb CHARSET=utf8mb4 COLLATE=utf8mb4_0900_as_cs;

INSERT INTO t_duckdb VALUES (1, 'a', 'a', 'a', 'a');
INSERT INTO t_innodb VALUES (1, 'a', 'a', 'a', 'a');

SELECT a FROM t_duckdb where a = 'a'; SELECT a FROM t_innodb where a = 'a';
SELECT a FROM t_duckdb where a = 'A'; SELECT a FROM t_innodb where a = 'A';
SELECT a FROM t_duckdb where a = '치'; SELECT a FROM t_innodb where a = '치';
SELECT b FROM t_duckdb where b = 'a'; SELECT b FROM t_innodb where b = 'a';
SELECT b FROM t_duckdb where b = 'A'; SELECT b FROM t_innodb where b = 'A';
SELECT b FROM t_duckdb where b = '치'; SELECT b FROM t_innodb where b = '치';
SELECT c FROM t_duckdb where c = 'a'; SELECT c FROM t_innodb where c = 'a';
SELECT c FROM t_duckdb where c = 'A'; SELECT c FROM t_innodb where c = 'A';
SELECT c FROM t_duckdb where c = '치'; SELECT c FROM t_innodb where c = '치';
SELECT d FROM t_duckdb where d = 'a'; SELECT d FROM t_innodb where d = 'a';
SELECT d FROM t_duckdb where d = 'A'; SELECT d FROM t_innodb where d = 'A';
SELECT d FROM t_duckdb where d = '치'; SELECT d FROM t_innodb where d = '치';

DROP TABLE t_duckdb, t_innodb;

--echo # 2.2 define collation for table with utf8mb3
CREATE TABLE t_duckdb (id INT PRIMARY KEY, a varchar(32), b varchar(32) COLLATE utf8mb3_general_mysql500_ci, c varchar(32) COLLATE utf8mb3_bin, d varchar(32) COLLATE utf8mb3_unicode_ci, e varchar(32) COLLATE utf8_tolower_ci) engine=duckdb CHARSET=utf8mb3 COLLATE=utf8_general_ci;
CREATE TABLE t_innodb (id INT PRIMARY KEY, a varchar(32), b varchar(32) COLLATE utf8mb3_general_mysql500_ci, c varchar(32) COLLATE utf8mb3_bin, d varchar(32) COLLATE utf8mb3_unicode_ci, e varchar(32) COLLATE utf8_tolower_ci) engine=innodb CHARSET=utf8mb3 COLLATE=utf8_general_ci;

INSERT INTO t_duckdb VALUES (1, 'a', 'a', 'a', 'a', 'a');
INSERT INTO t_innodb VALUES (1, 'a', 'a', 'a', 'a', 'a');

SELECT a FROM t_duckdb where a = 'a'; SELECT a FROM t_innodb where a = 'a';
SELECT a FROM t_duckdb where a = 'A'; SELECT a FROM t_innodb where a = 'A';
SELECT a FROM t_duckdb where a = '치'; SELECT a FROM t_innodb where a = '치';
SELECT b FROM t_duckdb where b = 'a'; SELECT b FROM t_innodb where b = 'a';
SELECT b FROM t_duckdb where b = 'A'; SELECT b FROM t_innodb where b = 'A';
SELECT b FROM t_duckdb where b = '치'; SELECT b FROM t_innodb where b = '치';
SELECT c FROM t_duckdb where c = 'a'; SELECT c FROM t_innodb where c = 'a';
SELECT c FROM t_duckdb where c = 'A'; SELECT c FROM t_innodb where c = 'A';
SELECT c FROM t_duckdb where c = '치';
SELECT c FROM t_innodb where c = '치';
SELECT d FROM t_duckdb where d = 'a'; SELECT d FROM t_innodb where d = 'a';
SELECT d FROM t_duckdb where d = 'A'; SELECT d FROM t_innodb where d = 'A';
SELECT d FROM t_duckdb where d = '치'; SELECT d FROM t_innodb where d = '치';
SELECT e FROM t_duckdb where e = 'a'; SELECT e FROM t_innodb where e = 'a';
SELECT e FROM t_duckdb where e = 'A'; SELECT e FROM t_innodb where e = 'A';
SELECT e FROM t_duckdb where e = '치'; SELECT e FROM t_innodb where e = '치';

DROP TABLE t_duckdb, t_innodb;


--echo #
--echo # Test 3. ALTER COLUMN COLLATION
--echo #
--echo # 3.1 define collation for table with utf8mb4
CREATE TABLE t_duckdb (id INT PRIMARY KEY, a varchar(32) COLLATE utf8mb4_general_ci) engine=duckdb CHARSET=utf8mb4 COLLATE=utf8mb4_0900_as_cs;
CREATE TABLE t_innodb (id INT PRIMARY KEY, a varchar(32) COLLATE utf8mb4_general_ci) engine=innodb CHARSET=utf8mb4 COLLATE=utf8mb4_0900_as_cs;

INSERT INTO t_duckdb VALUES (1, 'a');
INSERT INTO t_innodb VALUES (1, 'a');

SELECT a FROM t_duckdb where a = 'a'; SELECT a FROM t_innodb where a = 'a';
SELECT a FROM t_duckdb where a = 'A'; SELECT a FROM t_innodb where a = 'A';
SELECT a FROM t_duckdb where a = '치'; SELECT a FROM t_innodb where a = '치';

CALL dbms_duckdb.query("DELETE FROM test.t_duckdb");
DELETE FROM t_innodb;

# ALTER TABLE
ALTER TABLE t_duckdb MODIFY COLUMN a varchar(32),
                     ADD COLUMN b varchar(32) COLLATE utf8mb4_general_ci,
                     ADD COLUMN c varchar(32) COLLATE utf8mb4_0900_as_cs,
                     ADD COLUMN d varchar(32) COLLATE utf8mb4_0900_as_ci;
ALTER TABLE t_innodb MODIFY COLUMN a varchar(32),
                     ADD COLUMN b varchar(32) COLLATE utf8mb4_general_ci,
                     ADD COLUMN c varchar(32) COLLATE utf8mb4_0900_as_cs,
                     ADD COLUMN d varchar(32) COLLATE utf8mb4_0900_as_ci;

INSERT INTO t_duckdb VALUES (1, 'a', 'a', 'a', 'a');
INSERT INTO t_innodb VALUES (1, 'a', 'a', 'a', 'a');

SELECT a FROM t_duckdb where a = 'a'; SELECT a FROM t_innodb where a = 'a';
SELECT a FROM t_duckdb where a = 'A'; SELECT a FROM t_innodb where a = 'A';
SELECT a FROM t_duckdb where a = '치'; SELECT a FROM t_innodb where a = '치';
SELECT b FROM t_duckdb where b = 'a'; SELECT b FROM t_innodb where b = 'a';
SELECT b FROM t_duckdb where b = 'A'; SELECT b FROM t_innodb where b = 'A';
SELECT b FROM t_duckdb where b = '치'; SELECT b FROM t_innodb where b = '치';
SELECT c FROM t_duckdb where c = 'a'; SELECT c FROM t_innodb where c = 'a';
SELECT c FROM t_duckdb where c = 'A'; SELECT c FROM t_innodb where c = 'A';
SELECT c FROM t_duckdb where c = '치'; SELECT c FROM t_innodb where c = '치';
SELECT d FROM t_duckdb where d = 'a'; SELECT d FROM t_innodb where d = 'a';
SELECT d FROM t_duckdb where d = 'A'; SELECT d FROM t_innodb where d = 'A';
SELECT d FROM t_duckdb where d = '치'; SELECT d FROM t_innodb where d = '치';

DROP TABLE t_duckdb, t_innodb;


--echo # 3.2 define collation for table with utf8mb3
CREATE TABLE t_duckdb (id INT PRIMARY KEY, a varchar(32) COLLATE utf8_general_ci) engine=duckdb CHARSET=utf8mb3 COLLATE=utf8_general_ci;
CREATE TABLE t_innodb (id INT PRIMARY KEY, a varchar(32) COLLATE utf8_general_ci) engine=innodb CHARSET=utf8mb3 COLLATE=utf8_general_ci;

INSERT INTO t_duckdb VALUES (1, 'a');
INSERT INTO t_innodb VALUES (1, 'a');

SELECT a FROM t_duckdb where a = 'a'; SELECT a FROM t_innodb where a = 'a';
SELECT a FROM t_duckdb where a = 'A'; SELECT a FROM t_innodb where a = 'A';
SELECT a FROM t_duckdb where a = '치'; SELECT a FROM t_innodb where a = '치';

CALL dbms_duckdb.query("DELETE FROM test.t_duckdb");
DELETE FROM t_innodb;

# ALTER TABLE
ALTER TABLE t_duckdb MODIFY a varchar(32),
                     ADD COLUMN b varchar(32) COLLATE utf8mb3_general_mysql500_ci,
                     ADD COLUMN c varchar(32) COLLATE utf8mb3_bin,
                     ADD COLUMN d varchar(32) COLLATE utf8mb3_unicode_ci,
                     ADD COLUMN e varchar(32) COLLATE utf8_tolower_ci;
ALTER TABLE t_innodb MODIFY a varchar(32),
                     ADD COLUMN b varchar(32) COLLATE utf8mb3_general_mysql500_ci,
                     ADD COLUMN c varchar(32) COLLATE utf8mb3_bin,
                     ADD COLUMN d varchar(32) COLLATE utf8mb3_unicode_ci,
                     ADD COLUMN e varchar(32) COLLATE utf8_tolower_ci;

INSERT INTO t_duckdb VALUES (1, 'a', 'a', 'a', 'a', 'a');
INSERT INTO t_innodb VALUES (1, 'a', 'a', 'a', 'a', 'a');

SELECT a FROM t_duckdb where a = 'a'; SELECT a FROM t_innodb where a = 'a';
SELECT a FROM t_duckdb where a = 'A'; SELECT a FROM t_innodb where a = 'A';
SELECT a FROM t_duckdb where a = '치'; SELECT a FROM t_innodb where a = '치';
SELECT b FROM t_duckdb where b = 'a'; SELECT b FROM t_innodb where b = 'a';
SELECT b FROM t_duckdb where b = 'A'; SELECT b FROM t_innodb where b = 'A';
SELECT b FROM t_duckdb where b = '치'; SELECT b FROM t_innodb where b = '치';
SELECT c FROM t_duckdb where c = 'a'; SELECT c FROM t_innodb where c = 'a';
SELECT c FROM t_duckdb where c = 'A'; SELECT c FROM t_innodb where c = 'A';
# SELECT c FROM t_duckdb where c = '치'; # TODO: this query cannot executed
SELECT c FROM t_innodb where c = '치';
SELECT d FROM t_duckdb where d = 'a'; SELECT d FROM t_innodb where d = 'a';
SELECT d FROM t_duckdb where d = 'A'; SELECT d FROM t_innodb where d = 'A';
SELECT d FROM t_duckdb where d = '치'; SELECT d FROM t_innodb where d = '치';
SELECT e FROM t_duckdb where e = 'a'; SELECT e FROM t_innodb where e = 'a';
SELECT e FROM t_duckdb where e = 'A'; SELECT e FROM t_innodb where e = 'A';
SELECT e FROM t_duckdb where e = '치'; SELECT e FROM t_innodb where e = '치';

DROP TABLE t_duckdb, t_innodb;

--echo # 3.3 define collation for table with ascii
set names ascii;

CREATE TABLE t_duckdb (id INT PRIMARY KEY, a varchar(32) COLLATE ascii_general_ci) engine=duckdb CHARSET=ascii COLLATE=ascii_general_ci;
CREATE TABLE t_innodb (id INT PRIMARY KEY, a varchar(32) COLLATE ascii_general_ci) engine=innodb CHARSET=ascii COLLATE=ascii_general_ci;

INSERT INTO t_duckdb VALUES (1, 'a');
INSERT INTO t_innodb VALUES (1, 'a');

SELECT a FROM t_duckdb where a = 'a'; SELECT a FROM t_innodb where a = 'a';
SELECT a FROM t_duckdb where a = 'A'; SELECT a FROM t_innodb where a = 'A';

CALL dbms_duckdb.query("DELETE FROM test.t_duckdb");
DELETE FROM t_innodb;

# ALTER TABLE
ALTER TABLE t_duckdb ADD COLUMN b varchar(32) COLLATE ascii_general_ci,
                     ADD COLUMN c varchar(32) COLLATE ascii_bin;

ALTER TABLE t_innodb ADD COLUMN b varchar(32) COLLATE ascii_general_ci,
                     ADD COLUMN c varchar(32) COLLATE ascii_bin;

INSERT INTO t_duckdb VALUES (1, 'a', 'a', 'a');
INSERT INTO t_innodb VALUES (1, 'a', 'a', 'a');

SELECT a FROM t_duckdb where a = 'a'; SELECT a FROM t_innodb where a = 'a';
SELECT a FROM t_duckdb where a = 'A'; SELECT a FROM t_innodb where a = 'A';
SELECT b FROM t_duckdb where b = 'a'; SELECT b FROM t_innodb where b = 'a';
SELECT b FROM t_duckdb where b = 'A'; SELECT b FROM t_innodb where b = 'A';
SELECT c FROM t_duckdb where c = 'a'; SELECT c FROM t_innodb where c = 'a';
SELECT c FROM t_duckdb where c = 'A'; SELECT c FROM t_innodb where c = 'A';

DROP TABLE t_duckdb, t_innodb;

SET NAMES utf8mb4; 


--echo #
--echo # Test 4. NON-UTF8 CHARSET
--echo #
--echo # 4.1 CREATE TABLE
--error ER_DUCKDB_TABLE_STRUCT_INVALID
CREATE TABLE t_duckdb (id INT PRIMARY KEY, a varchar(32)) engine=duckdb CHARSET=latin1;
--error ER_DUCKDB_TABLE_STRUCT_INVALID
CREATE TABLE t_duckdb (id INT PRIMARY KEY, a varchar(32) CHARSET latin1) engine=duckdb CHARSET=utf8mb4;
--error ER_DUCKDB_TABLE_STRUCT_INVALID
CREATE TABLE t_duckdb (id INT PRIMARY KEY, a varchar(32) COLLATE latin1_general_ci) engine=duckdb CHARSET=utf8mb4;

--echo # 4.2 ALTER TABLE
CREATE TABLE t_duckdb (id INT PRIMARY KEY, a varchar(32) CHARSET utf8mb3, b varchar(32) CHARSET utf8mb4) engine=duckdb CHARSET=latin1;

--error ER_DUCKDB_TABLE_STRUCT_INVALID
ALTER TABLE t_duckdb ADD COLUMN c varchar(32);
ALTER TABLE t_duckdb ADD COLUMN c varchar(32) CHARSET utf8mb3, ADD COLUMN d varchar(32) CHARSET utf8mb4;

--error ER_DUCKDB_TABLE_STRUCT_INVALID
ALTER TABLE t_duckdb MODIFY COLUMN a varchar(32);
--error ER_DUCKDB_TABLE_STRUCT_INVALID
ALTER TABLE t_duckdb MODIFY COLUMN b varchar(32) CHARSET latin1;


--echo #
--echo # Test 5. UTF8MB4 with Emoji
--echo #

CREATE TABLE t_mb4 (
  id int primary key,
  a varchar(32) CHARSET utf8mb4,
  b char(32) CHARSET utf8mb4,
  c text(32) CHARSET utf8mb4,
  d varchar(32) CHARSET utf8mb4
) ENGINE=duckdb;

# check emoji can be inserted successfully
INSERT INTO t_mb4 VALUES (1, 'a', 'b', 'c', 'd');
INSERT INTO t_mb4 VALUES (2, UNHEX('F09F9884'), UNHEX('F09F9884'), UNHEX('F09F9884'), '游땴h游땏h游땴');

SET GLOBAL duckdb_dml_in_batch = on;
INSERT INTO t_mb4 VALUES (3, UNHEX('F09F9884'), UNHEX('F09F9884'), UNHEX('F09F9884'), '游땴h游땏h游땴');
SET GLOBAL duckdb_dml_in_batch = default;

# check emoji can be selected successfully
SELECT * from t_mb4;

# check emoji can be read when copy-ddl
ALTER TABLE t_mb4 ADD e varchar(32) AFTER a, algorithm=copy;
SELECT * from t_mb4;

ALTER TABLE t_mb4 ENGINE=innodb;
SELECT * from t_mb4;

DROP TABLE t_duckdb, t_mb4;
