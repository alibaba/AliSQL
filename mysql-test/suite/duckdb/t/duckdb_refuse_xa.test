CREATE TABLE t1 (c1 INT PRIMARY KEY, c2 VARCHAR(5)) ENGINE=duckdb;

# xa start
XA START 'xa_1';

--error ER_XAER_RMFAIL
CREATE TABLE t2 (c1 INT PRIMARY KEY, c2 VARCHAR(5)) ENGINE=duckdb;

--error ER_XAER_RMFAIL
INSERT INTO t1 (c2) VALUES ('a');

--error ER_XAER_RMFAIL
ALTER TABLE t1 ADD COLUMN c3 INT;

--error ER_XAER_RMFAIL
ALTER TABLE t1 RENAME TO t2;

--error ER_XAER_RMFAIL
DROP TABLE t1;

--error ER_XAER_RMFAIL
TRUNCATE TABLE t1;

# xa end

XA END 'xa_1';
--error ER_XAER_RMFAIL
INSERT INTO t1 (c1, c2) VALUES (1, 'a');

--error ER_XAER_RMFAIL
ALTER TABLE t1 ADD COLUMN c3 INT;

--error ER_XAER_RMFAIL
ALTER TABLE t1 RENAME TO t2;

--error ER_XAER_RMFAIL
TRUNCATE TABLE t1;

--error ER_XAER_RMFAIL
DROP TABLE t1;

# xa prepare

XA PREPARE 'xa_1';
INSERT INTO t1 (c1, c2) VALUES (1, 'a');

# xa commit
XA COMMIT 'xa_1';
CREATE TABLE t2 (c1 INT PRIMARY KEY, c2 VARCHAR(5)) ENGINE=duckdb;

INSERT INTO t1 (c1, c2) VALUES (2, 'a');
TRUNCATE TABLE t1;
ALTER TABLE t1 ADD COLUMN c3 INT;
ALTER TABLE t1 RENAME TO t3;

DROP TABLE t2;
DROP TABLE t3;
