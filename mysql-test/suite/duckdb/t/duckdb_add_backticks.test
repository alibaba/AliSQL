SET GLOBAL duckdb_require_primary_key=OFF;

--echo #
--echo # Test whether the convertor accurately adds backticks to schema names, 
--echo # table names, and column names in DDL statements
--echo # and correctly passes them to the DuckDB engine for execution.
--echo #

--echo #
--echo # Test: drop and create databases with a name starting with a digit or containing only digits.
--echo #
--disable_warnings
DROP DATABASE IF EXISTS `09898141`;
--enable_warnings
CREATE DATABASE `09898141`;
--disable_warnings
DROP DATABASE IF EXISTS `011fq123`;
--enable_warnings
CREATE DATABASE `011fq123`;
USE `09898141`;
SELECT schema_name FROM information_schema.schemata WHERE schema_name = '09898141';
CALL DBMS_DUCKDB.QUERY("SELECT schema_name FROM information_schema.schemata WHERE schema_name = '09898141'");
SELECT schema_name FROM information_schema.schemata WHERE schema_name = '011fq123';
CALL DBMS_DUCKDB.QUERY("SELECT schema_name FROM information_schema.schemata WHERE schema_name = '011fq123'");


--echo #
--echo # Test: drop and create tables with a name starting with a digit or containing only digits.
--echo #
--disable_warnings
DROP TABLE IF EXISTS `001`;
--enable_warnings
CREATE TABLE `001` (
    `00000000000` BIGINT NOT NULL DEFAULT '0' PRIMARY KEY,
    `0a01131` VARCHAR(50)
) ENGINE=DuckDB;
--disable_warnings
DROP TABLE IF EXISTS `111a`;
--enable_warnings
CREATE TABLE `111a` (
    `#0x1141` BIGINT NOT NULL DEFAULT '0' PRIMARY KEY
) ENGINE=DuckDB;
CREATE TABLE `321` (
    `009` BIGINT NOT NULL DEFAULT '0' PRIMARY KEY
) ENGINE=DuckDB;
SELECT table_name FROM information_schema.tables WHERE table_schema='09898141';
CALL DBMS_DUCKDB.QUERY("SELECT table_name FROM information_schema.tables WHERE table_schema='09898141'");
SELECT column_name FROM information_schema.columns WHERE table_schema='09898141' and table_name='001';
CALL DBMS_DUCKDB.QUERY("SELECT column_name FROM information_schema.columns WHERE table_schema='09898141' and table_name='001'");
SELECT column_name FROM information_schema.columns WHERE table_schema='09898141' and table_name='111a';
CALL DBMS_DUCKDB.QUERY("SELECT column_name FROM information_schema.columns WHERE table_schema='09898141' and table_name='111a'");
SELECT column_name FROM information_schema.columns WHERE table_schema='09898141' and table_name='321';
CALL DBMS_DUCKDB.QUERY("SELECT column_name FROM information_schema.columns WHERE table_schema='09898141' and table_name='321'");

--echo #
--echo # Test: insert(delete and update are not currently supported)
--echo #
USE `09898141`;
INSERT INTO `001` VALUES (1, 'a'),(2, 'b'),(3, 'c'),(4, 'd'),(5, 'e');
INSERT INTO `111a` VALUES (1), (2), (3), (4), (5);
SELECT * from `09898141`.`001`;
CALL DBMS_DUCKDB.QUERY("SELECT * FROM `09898141`.`001`");
SELECT * from `09898141`.`111a`;
CALL DBMS_DUCKDB.QUERY("SELECT * from `09898141`.`111a`");


--echo #
--echo # Test: select
--echo #
SELECT * FROM `001` ORDER BY `00000000000` DESC;
CALL DBMS_DUCKDB.QUERY("SELECT * FROM `09898141`.`001` ORDER BY `00000000000` DESC");
SELECT COUNT(*) FROM `001` WHERE `00000000000` > 2 GROUP BY `00000000000`;
CALL DBMS_DUCKDB.QUERY("SELECT COUNT(*) FROM `09898141`.`001` WHERE `00000000000` > 2 GROUP BY `00000000000`");

USE `011fq123`;
SELECT `#0x1141` FROM `09898141`.`111a` ORDER BY `#0x1141` DESC;
CALL DBMS_DUCKDB.QUERY("SELECT `#0x1141` FROM `09898141`.`111a` ORDER BY `#0x1141` DESC");
SELECT `0a01131` FROM `09898141`.`001` ORDER BY `0a01131` DESC;
CALL DBMS_DUCKDB.QUERY("SELECT `0a01131` FROM `09898141`.`001` ORDER BY `0a01131` DESC");

--echo #
--echo # Test: alter table
--echo #
USE `09898141`;
ALTER TABLE `001` ADD COLUMN `0A` BIGINT DEFAULT 0;
SHOW CREATE TABLE `001`;
CALL DBMS_DUCKDB.QUERY("PRAGMA table_info(`09898141`.`001`)");
SELECT * FROM `001`;
CALL DBMS_DUCKDB.QUERY("SELECT * FROM `09898141`.`001`");
ALTER TABLE `001` MODIFY `0A` INT;
ALTER TABLE `001` RENAME COLUMN `0A` TO `0B`;
ALTER TABLE `001` MODIFY `0B` INT DEFAULT '0';
ALTER TABLE `001` MODIFY `0B` INT  NOT NULL;
ALTER TABLE `09898141`.`001` MODIFY `0B` INT NULL;
ALTER TABLE `09898141`.`001` MODIFY `0B` INT;
ALTER TABLE `09898141`.`001` RENAME TO `101`;
SHOW CREATE TABLE `101`;
CALL DBMS_DUCKDB.QUERY("PRAGMA table_info(`09898141`.`101`)");
SELECT * FROM `101`;
CALL DBMS_DUCKDB.QUERY("SELECT * FROM `09898141`.`101`");
ALTER TABLE `101` DROP COLUMN `0B`;
SELECT * FROM `101`;
CALL DBMS_DUCKDB.QUERY("SELECT * FROM `09898141`.`101`");


--echo #
--echo # Test: truncate tables
--echo #
TRUNCATE TABLE `09898141`.`111a`;


--echo #
--echo # Test: create tables with special characters
--echo #
--disable_warnings
DROP DATABASE IF EXISTS mydb1;
--enable_warnings
CREATE DATABASE mydb1;
CREATE TABLE mydb1.t (i INT, d DECIMAL, f FLOAT);
INSERT INTO mydb1.t VALUES(1,1,1);
CREATE TABLE mydb1.y ENGINE=DuckDB AS SELECT AVG(i), AVG(d), AVG(f) FROM mydb1.t;  
SHOW CREATE TABLE mydb1.y; 
CALL DBMS_DUCKDB.QUERY("PRAGMA table_info(mydb1.y)");


--echo #
--echo # Test: drop databases(cascade)
--echo #
DROP DATABASE IF EXISTS `09898141`;
DROP DATABASE IF EXISTS `011fq123`;
DROP DATABASE IF EXISTS mydb1;


--echo #
--echo # Test: database, table and column names with space.
--echo #
CREATE DATABASE `my db`;
CREATE TABLE `my db`.`my table` (
  `my column` INT
) ENGINE=DuckDB;
INSERT INTO `my db`.`my table` VALUES(1);
SELECT `my column` FROM `my db`.`my table`;

CALL DBMS_DUCKDB.QUERY("SELECT schema_name FROM information_schema.schemata WHERE schema_name = 'my db'");
SELECT schema_name FROM information_schema.schemata WHERE schema_name = 'my db';

CALL DBMS_DUCKDB.QUERY("PRAGMA table_info(`my db`.`my table`)");
SHOW CREATE TABLE `my db`.`my table`;

DROP DATABASE `my db`;
CALL DBMS_DUCKDB.QUERY("SELECT schema_name FROM information_schema.schemata WHERE schema_name = 'my db'");

#
# CLEANUP
#
--disable_warnings
SET GLOBAL duckdb_require_primary_key=ON;
--enable_warnings
