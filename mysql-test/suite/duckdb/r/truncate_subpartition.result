#
# 1) Create subpartition table
#
SET GLOBAL duckdb_log_options = 'DUCKDB_MULTI_TRX_BATCH_COMMIT,DUCKDB_MULTI_TRX_BATCH_DETAIL,DUCKDB_QUERY,DUCKDB_QUERY_RESULT';
CREATE TABLE t_range (i INTEGER KEY) ENGINE = DuckDB
PARTITION BY RANGE(i) PARTITIONS 3 SUBPARTITION BY HASH(i) (
PARTITION p0 VALUES LESS THAN(100) (SUBPARTITION sp00, SUBPARTITION sp01),
PARTITION p1 VALUES LESS THAN(200) (SUBPARTITION sp10, SUBPARTITION sp11),
PARTITION p2 VALUES LESS THAN MAXVALUE (SUBPARTITION sp20, SUBPARTITION sp21)
);
INSERT INTO t_range VALUES (0), (1), (100), (101), (200), (201);
CREATE TABLE t_list (i INTEGER KEY) ENGINE = DuckDB
PARTITION BY LIST(MOD(i, 2)) SUBPARTITION BY KEY(i) (
PARTITION p0 VALUES IN (-1) (SUBPARTITION sp00, SUBPARTITION sp01),
PARTITION p1 VALUES IN (0) (SUBPARTITION sp10, SUBPARTITION sp11),
PARTITION p2 VALUES IN (1) (SUBPARTITION sp20, SUBPARTITION sp21)
);
INSERT INTO t_list VALUES (-1), (0), (1), (-3), (2), (3);
#
# 2) Truncate subpartition
#
ALTER TABLE t_range TRUNCATE PARTITION sp00;
ERROR HY000: [DuckDB] TRUNCATE SUBPARTITION is not supported for this operation.
ALTER TABLE t_range TRUNCATE PARTITION sp00, sp11;
ERROR HY000: [DuckDB] TRUNCATE SUBPARTITION is not supported for this operation.
ALTER TABLE t_range TRUNCATE PARTITION p0, p1, sp21;
ERROR HY000: [DuckDB] TRUNCATE SUBPARTITION is not supported for this operation.
ALTER TABLE t_list TRUNCATE PARTITION sp00;
ERROR HY000: [DuckDB] TRUNCATE SUBPARTITION is not supported for this operation.
ALTER TABLE t_list TRUNCATE PARTITION sp00, sp11;
ERROR HY000: [DuckDB] TRUNCATE SUBPARTITION is not supported for this operation.
ALTER TABLE t_list TRUNCATE PARTITION p0, p1, sp21;
ERROR HY000: [DuckDB] TRUNCATE SUBPARTITION is not supported for this operation.
ALTER TABLE t_range TRUNCATE PARTITION p1, sp00, sp01;
SELECT * FROM t_range;
i
200
201
ALTER TABLE t_list TRUNCATE PARTITION p1, sp00, sp01;
SELECT * FROM t_list;
i
1
3
USE `test`; DELETE FROM `t_range` WHERE (`i`) < (100); DELETE FROM `t_range` WHERE (`i`) < (200) AND (`i`) >= (100);
USE `test`; DELETE FROM `t_list` WHERE ((`i` % 2)) IN (-1); DELETE FROM `t_list` WHERE ((`i` % 2)) IN (0);
#
# 3) Cleanup
#
SET GLOBAL duckdb_log_options = default;
DROP TABLE t_range, t_list;
