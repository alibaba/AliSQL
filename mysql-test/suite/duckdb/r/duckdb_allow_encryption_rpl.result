include/master-slave.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the connection metadata repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
[connection master]
#
# create tables in master
#
DROP DATABASE IF EXISTS encryption_test;
CREATE DATABASE encryption_test;
USE encryption_test;
CREATE TABLE string_table (
id INT PRIMARY KEY,
bool_field BOOLEAN DEFAULT TRUE,
decimal_field DECIMAL(10,2) DEFAULT 1.11,
enum_field ENUM('small', 'medium', 'large') DEFAULT 'medium',
set_field SET('red', 'green', 'blue'),
varchar_field VARCHAR(255) DEFAULT 'ABC',
json_field JSON,
text_field TEXT,
new_decimal_field DECIMAL(20,6)
) ENGINE=InnoDB;
INSERT INTO string_table VALUES (1, TRUE, 123.45, 'small', 'red,green', 'varchar_sample','{"name": "Alice", "age": 30}', 'This is a sample text.', 123456.789012);
INSERT INTO string_table VALUES (2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL);
#
# check initial table info
#
SHOW CREATE TABLE encryption_test.string_table;
Table	Create Table
string_table	CREATE TABLE `string_table` (
  `id` int NOT NULL,
  `bool_field` tinyint(1) DEFAULT '1',
  `decimal_field` decimal(10,2) DEFAULT '1.11',
  `enum_field` enum('small','medium','large') DEFAULT 'medium',
  `set_field` set('red','green','blue') DEFAULT NULL,
  `varchar_field` varchar(255) DEFAULT 'ABC',
  `json_field` json DEFAULT NULL,
  `text_field` text,
  `new_decimal_field` decimal(20,6) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
CHECKSUM TABLE encryption_test.string_table;
Table	Checksum
encryption_test.string_table	4278763905
include/rpl_sync.inc
[connection slave]
SHOW CREATE TABLE encryption_test.string_table;
Table	Create Table
string_table	CREATE TABLE `string_table` (
  `id` int NOT NULL,
  `bool_field` tinyint(1) DEFAULT '1',
  `decimal_field` decimal(10,2) DEFAULT '1.11',
  `enum_field` enum('small','medium','large') DEFAULT 'medium',
  `set_field` set('red','green','blue') DEFAULT NULL,
  `varchar_field` varchar(255) DEFAULT 'ABC',
  `json_field` json DEFAULT NULL,
  `text_field` text,
  `new_decimal_field` decimal(20,6) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=DUCKDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
CHECKSUM TABLE encryption_test.string_table;
Table	Checksum
encryption_test.string_table	4278763905
#
# test: alter encryption options and recheck table info, check data comcistency 
#
[connection master]
ALTER TABLE encryption_test.string_table ENCRYPTION='Y';
INSERT INTO string_table VALUES (3, FALSE, 678.90, 'medium', 'blue',  NULL, NULL, NULL, 345678.901234);
SHOW CREATE TABLE encryption_test.string_table;
Table	Create Table
string_table	CREATE TABLE `string_table` (
  `id` int NOT NULL,
  `bool_field` tinyint(1) DEFAULT '1',
  `decimal_field` decimal(10,2) DEFAULT '1.11',
  `enum_field` enum('small','medium','large') DEFAULT 'medium',
  `set_field` set('red','green','blue') DEFAULT NULL,
  `varchar_field` varchar(255) DEFAULT 'ABC',
  `json_field` json DEFAULT NULL,
  `text_field` text,
  `new_decimal_field` decimal(20,6) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci ENCRYPTION='Y'
CHECKSUM TABLE encryption_test.string_table;
Table	Checksum
encryption_test.string_table	77928235
include/rpl_sync.inc
[connection slave]
SHOW CREATE TABLE encryption_test.string_table;
Table	Create Table
string_table	CREATE TABLE `string_table` (
  `id` int NOT NULL,
  `bool_field` tinyint(1) DEFAULT '1',
  `decimal_field` decimal(10,2) DEFAULT '1.11',
  `enum_field` enum('small','medium','large') DEFAULT 'medium',
  `set_field` set('red','green','blue') DEFAULT NULL,
  `varchar_field` varchar(255) DEFAULT 'ABC',
  `json_field` json DEFAULT NULL,
  `text_field` text,
  `new_decimal_field` decimal(20,6) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=DUCKDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci ENCRYPTION='Y'
CHECKSUM TABLE encryption_test.string_table;
Table	Checksum
encryption_test.string_table	77928235
[connection master]
ALTER TABLE encryption_test.string_table ENCRYPTION='N';
INSERT INTO string_table VALUES (4, FALSE, 381.90, 'large', 'blue',  'varchar_a', '{"name": "Mike", "age": 30}', NULL, 0.901234);
SHOW CREATE TABLE encryption_test.string_table;
Table	Create Table
string_table	CREATE TABLE `string_table` (
  `id` int NOT NULL,
  `bool_field` tinyint(1) DEFAULT '1',
  `decimal_field` decimal(10,2) DEFAULT '1.11',
  `enum_field` enum('small','medium','large') DEFAULT 'medium',
  `set_field` set('red','green','blue') DEFAULT NULL,
  `varchar_field` varchar(255) DEFAULT 'ABC',
  `json_field` json DEFAULT NULL,
  `text_field` text,
  `new_decimal_field` decimal(20,6) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
CHECKSUM TABLE encryption_test.string_table;
Table	Checksum
encryption_test.string_table	979234908
include/rpl_sync.inc
[connection slave]
SHOW CREATE TABLE encryption_test.string_table;
Table	Create Table
string_table	CREATE TABLE `string_table` (
  `id` int NOT NULL,
  `bool_field` tinyint(1) DEFAULT '1',
  `decimal_field` decimal(10,2) DEFAULT '1.11',
  `enum_field` enum('small','medium','large') DEFAULT 'medium',
  `set_field` set('red','green','blue') DEFAULT NULL,
  `varchar_field` varchar(255) DEFAULT 'ABC',
  `json_field` json DEFAULT NULL,
  `text_field` text,
  `new_decimal_field` decimal(20,6) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=DUCKDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
CHECKSUM TABLE encryption_test.string_table;
Table	Checksum
encryption_test.string_table	979234908
[connection master]
ALTER TABLE encryption_test.string_table ENCRYPTION='Y';
INSERT INTO string_table VALUES (5, TRUE, 111.50, NULL, 'red',  'varchar_bbb', '{"name": "Kitty", "age": 10}', NULL, 0.901234);
SHOW CREATE TABLE encryption_test.string_table;
Table	Create Table
string_table	CREATE TABLE `string_table` (
  `id` int NOT NULL,
  `bool_field` tinyint(1) DEFAULT '1',
  `decimal_field` decimal(10,2) DEFAULT '1.11',
  `enum_field` enum('small','medium','large') DEFAULT 'medium',
  `set_field` set('red','green','blue') DEFAULT NULL,
  `varchar_field` varchar(255) DEFAULT 'ABC',
  `json_field` json DEFAULT NULL,
  `text_field` text,
  `new_decimal_field` decimal(20,6) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci ENCRYPTION='Y'
CHECKSUM TABLE encryption_test.string_table;
Table	Checksum
encryption_test.string_table	3151651463
include/rpl_sync.inc
[connection slave]
SHOW CREATE TABLE encryption_test.string_table;
Table	Create Table
string_table	CREATE TABLE `string_table` (
  `id` int NOT NULL,
  `bool_field` tinyint(1) DEFAULT '1',
  `decimal_field` decimal(10,2) DEFAULT '1.11',
  `enum_field` enum('small','medium','large') DEFAULT 'medium',
  `set_field` set('red','green','blue') DEFAULT NULL,
  `varchar_field` varchar(255) DEFAULT 'ABC',
  `json_field` json DEFAULT NULL,
  `text_field` text,
  `new_decimal_field` decimal(20,6) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=DUCKDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci ENCRYPTION='Y'
CHECKSUM TABLE encryption_test.string_table;
Table	Checksum
encryption_test.string_table	3151651463
#
# test: create table with encryption option 
#
[connection master]
CREATE TABLE encryption_test.date_table(
id INT PRIMARY KEY, 
date_field DATE DEFAULT '2009-12-30',
datetime_field DATETIME DEFAULT '2023-03-01 11:00:00',
timestamp_field TIMESTAMP DEFAULT '2023-01-01 12:00:00',
time_field TIME DEFAULT '12:00:00'
) ENCRYPTION='Y';
INSERT INTO date_table VALUES 
(1, '2023-01-01', '2023-01-01 12:00:00', '2023-01-01 12:00:00', '12:00:00'),
(2, '1999-12-31', '1999-12-31 23:59:59', '1999-12-31 23:59:59', NULL),
(3, NULL, NULL, NULL, '00:00:00');
SHOW CREATE TABLE encryption_test.date_table;
Table	Create Table
date_table	CREATE TABLE `date_table` (
  `id` int NOT NULL,
  `date_field` date DEFAULT '2009-12-30',
  `datetime_field` datetime DEFAULT '2023-03-01 11:00:00',
  `timestamp_field` timestamp NULL DEFAULT '2023-01-01 12:00:00',
  `time_field` time DEFAULT '12:00:00',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci ENCRYPTION='Y'
CHECKSUM TABLE encryption_test.date_table;
Table	Checksum
encryption_test.date_table	3557154863
include/rpl_sync.inc
[connection slave]
SHOW CREATE TABLE encryption_test.date_table;
Table	Create Table
date_table	CREATE TABLE `date_table` (
  `id` int NOT NULL,
  `date_field` date DEFAULT '2009-12-30',
  `datetime_field` datetime DEFAULT '2023-03-01 11:00:00',
  `timestamp_field` timestamp NULL DEFAULT '2023-01-01 12:00:00',
  `time_field` time DEFAULT '12:00:00',
  PRIMARY KEY (`id`)
) ENGINE=DUCKDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci ENCRYPTION='Y'
CHECKSUM TABLE encryption_test.date_table;
Table	Checksum
encryption_test.date_table	3557154863
#
# CLEANUP
#
[connection master]
DROP DATABASE IF EXISTS encryption_test;
include/rpl_sync.inc
include/rpl_end.inc
