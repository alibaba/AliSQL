include/master-slave.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the connection metadata repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
[connection master]
#
# Test: create tables in master
#
DROP DATABASE IF EXISTS alter_test;
CREATE DATABASE alter_test;
USE alter_test;
CREATE TABLE t1 (id int PRIMARY KEY, name varchar(255), f float, d double) ENGINE = InnoDB;
CREATE TABLE t2 (id int PRIMARY KEY, name varchar(255), f float, d double) ENGINE = InnoDB;
CREATE TABLE t3 (id int PRIMARY KEY, name varchar(255), f float, d double) ENGINE = InnoDB;
INSERT INTO t1 VALUES (1, 'test', 1.1, 1.2);
INSERT INTO t3 VALUES (2, 'test2', 2.1, 2.2);
INSERT INTO t3 VALUES (3, 'test3', 3.1, 3.2);
#
#check initial table info
#
SHOW CREATE TABLE alter_test.t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int NOT NULL,
  `name` varchar(255) DEFAULT NULL,
  `f` float DEFAULT NULL,
  `d` double DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
include/rpl_sync.inc
[connection slave]
SHOW CREATE TABLE alter_test.t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int NOT NULL,
  `name` varchar(255) DEFAULT NULL,
  `f` float DEFAULT NULL,
  `d` double DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=DUCKDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
#
# alter table engine to innodb, slave node should not change
#
[connection master]
ALTER TABLE alter_test.t1 ENGINE = InnoDB;
SHOW CREATE TABLE alter_test.t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int NOT NULL,
  `name` varchar(255) DEFAULT NULL,
  `f` float DEFAULT NULL,
  `d` double DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
include/rpl_sync.inc
[connection slave]
SHOW CREATE TABLE alter_test.t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int NOT NULL,
  `name` varchar(255) DEFAULT NULL,
  `f` float DEFAULT NULL,
  `d` double DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=DUCKDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
[connection master]
ALTER TABLE alter_test.t1 ENGINE = InnoDB;
SHOW CREATE TABLE alter_test.t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int NOT NULL,
  `name` varchar(255) DEFAULT NULL,
  `f` float DEFAULT NULL,
  `d` double DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
include/rpl_sync.inc
[connection slave]
SHOW CREATE TABLE alter_test.t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int NOT NULL,
  `name` varchar(255) DEFAULT NULL,
  `f` float DEFAULT NULL,
  `d` double DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=DUCKDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
#
#check initial table info
#
[connection master]
SHOW CREATE TABLE alter_test.t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `id` int NOT NULL,
  `name` varchar(255) DEFAULT NULL,
  `f` float DEFAULT NULL,
  `d` double DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
include/rpl_sync.inc
[connection slave]
SHOW CREATE TABLE alter_test.t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `id` int NOT NULL,
  `name` varchar(255) DEFAULT NULL,
  `f` float DEFAULT NULL,
  `d` double DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=DUCKDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
#
# alter table engine to myisam/duckdb, slave node should change
#
[connection master]
ALTER TABLE alter_test.t2 ENGINE = MyISAM;
SHOW CREATE TABLE alter_test.t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `id` int NOT NULL,
  `name` varchar(255) DEFAULT NULL,
  `f` float DEFAULT NULL,
  `d` double DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
include/rpl_sync.inc
[connection slave]
SHOW CREATE TABLE alter_test.t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `id` int NOT NULL,
  `name` varchar(255) DEFAULT NULL,
  `f` float DEFAULT NULL,
  `d` double DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
[connection master]
ALTER TABLE alter_test.t2 ENGINE = DuckDB;
SHOW CREATE TABLE alter_test.t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `id` int NOT NULL,
  `name` varchar(255) DEFAULT NULL,
  `f` float DEFAULT NULL,
  `d` double DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=DUCKDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
include/rpl_sync.inc
[connection slave]
SHOW CREATE TABLE alter_test.t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `id` int NOT NULL,
  `name` varchar(255) DEFAULT NULL,
  `f` float DEFAULT NULL,
  `d` double DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=DUCKDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
#check initial table info
#
[connection master]
SHOW CREATE TABLE alter_test.t3;
Table	Create Table
t3	CREATE TABLE `t3` (
  `id` int NOT NULL,
  `name` varchar(255) DEFAULT NULL,
  `f` float DEFAULT NULL,
  `d` double DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
include/rpl_sync.inc
[connection slave]
SHOW CREATE TABLE alter_test.t3;
Table	Create Table
t3	CREATE TABLE `t3` (
  `id` int NOT NULL,
  `name` varchar(255) DEFAULT NULL,
  `f` float DEFAULT NULL,
  `d` double DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=DUCKDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
#
# alter table engine to innodb and add column, slave node should ignore "alter engine" but execute "add column"
#
[connection master]
ALTER TABLE alter_test.t3 ADD COLUMN b INT, ENGINE = InnoDB;
SHOW CREATE TABLE alter_test.t3;
Table	Create Table
t3	CREATE TABLE `t3` (
  `id` int NOT NULL,
  `name` varchar(255) DEFAULT NULL,
  `f` float DEFAULT NULL,
  `d` double DEFAULT NULL,
  `b` int DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
include/rpl_sync.inc
[connection slave]
SHOW CREATE TABLE alter_test.t3;
Table	Create Table
t3	CREATE TABLE `t3` (
  `id` int NOT NULL,
  `name` varchar(255) DEFAULT NULL,
  `f` float DEFAULT NULL,
  `d` double DEFAULT NULL,
  `b` int DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=DUCKDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
#
# CLEANUP
#
[connection master]
DROP DATABASE IF EXISTS alter_test;
include/rpl_sync.inc
include/rpl_end.inc
