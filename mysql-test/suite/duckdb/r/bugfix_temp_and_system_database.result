#
# TEST FOR `temp` and `system`
#
CALL dbms_duckdb.query("SELECT * FROM information_schema.schemata WHERE catalog_name in (\"system\", \"temp\") or schema_name in (\"system\", \"temp\")");
RESULT
catalog_name	schema_name	schema_owner	default_character_set_catalog	default_character_set_schema	default_character_set_name	sql_path	
VARCHAR	VARCHAR	VARCHAR	VARCHAR	VARCHAR	VARCHAR	VARCHAR	
[ Rows: 4]
system	information_schema	duckdb	NULL	NULL	NULL	NULL
system	main	duckdb	NULL	NULL	NULL	NULL
system	pg_catalog	duckdb	NULL	NULL	NULL	NULL
temp	main	duckdb	NULL	NULL	NULL	NULL


CREATE DATABASE `temp`;
USE `temp`;
CREATE TABLE t1(a INT KEY) ENGINE = DuckDB;
CALL dbms_duckdb.query("SELECT * FROM information_schema.schemata WHERE catalog_name in (\"system\", \"temp\") or schema_name in (\"system\", \"temp\")");
RESULT
catalog_name	schema_name	schema_owner	default_character_set_catalog	default_character_set_schema	default_character_set_name	sql_path	
VARCHAR	VARCHAR	VARCHAR	VARCHAR	VARCHAR	VARCHAR	VARCHAR	
[ Rows: 5]
duckdb	temp	duckdb	NULL	NULL	NULL	NULL
system	information_schema	duckdb	NULL	NULL	NULL	NULL
system	main	duckdb	NULL	NULL	NULL	NULL
system	pg_catalog	duckdb	NULL	NULL	NULL	NULL
temp	main	duckdb	NULL	NULL	NULL	NULL


RENAME TABLE t1 TO t2;
ALTER TABLE t2 RENAME TO t1;
ALTER TABLE t1 ADD COLUMN b INT;
TRUNCATE TABLE t1;
USE `test`;
SET GLOBAL duckdb_dml_in_batch = ON;
INSERT INTO temp.t1 VALUES (1, 1), (2, 1), (3, 1);
SET GLOBAL duckdb_dml_in_batch = OFF;
INSERT INTO temp.t1 VALUES (4, 1);
ERROR HY000: [DuckDB] Execute sql failed. Binder Error: Ambiguous reference to catalog or schema "temp" - use a fully qualified path like "duckdb.temp"
SELECT * FROM temp.t1;
ERROR HY000: [DuckDB] Binder Error: Ambiguous reference to catalog or schema "temp" - use a fully qualified path like "duckdb.temp".
UPDATE temp.t1 SET b = 1;
ERROR HY000: [DuckDB] Binder Error: Ambiguous reference to catalog or schema "temp" - use a fully qualified path like "duckdb.temp".
DELETE FROM temp.t1;
ERROR HY000: [DuckDB] Binder Error: Ambiguous reference to catalog or schema "temp" - use a fully qualified path like "duckdb.temp".
USE `temp`;
DROP TABLE t1;
CREATE DATABASE `system`;
USE `system`;
CREATE TABLE t1(a INT KEY) ENGINE = DuckDB;
CALL dbms_duckdb.query("SELECT * FROM information_schema.schemata WHERE catalog_name in (\"system\", \"temp\") or schema_name in (\"system\", \"temp\")");
RESULT
catalog_name	schema_name	schema_owner	default_character_set_catalog	default_character_set_schema	default_character_set_name	sql_path	
VARCHAR	VARCHAR	VARCHAR	VARCHAR	VARCHAR	VARCHAR	VARCHAR	
[ Rows: 6]
duckdb	system	duckdb	NULL	NULL	NULL	NULL
duckdb	temp	duckdb	NULL	NULL	NULL	NULL
system	information_schema	duckdb	NULL	NULL	NULL	NULL
system	main	duckdb	NULL	NULL	NULL	NULL
system	pg_catalog	duckdb	NULL	NULL	NULL	NULL
temp	main	duckdb	NULL	NULL	NULL	NULL


RENAME TABLE t1 TO t2;
ALTER TABLE t2 RENAME TO t1;
ALTER TABLE t1 ADD COLUMN b INT;
TRUNCATE TABLE t1;
USE `test`;
SET GLOBAL duckdb_dml_in_batch = ON;
INSERT INTO system.t1 VALUES (1, 1), (2, 1), (3, 1);
SET GLOBAL duckdb_dml_in_batch = OFF;
INSERT INTO system.t1 VALUES (4, 1);
ERROR HY000: [DuckDB] Execute sql failed. Binder Error: Ambiguous reference to catalog or schema "system" - use a fully qualified path like "duckdb.system"
SELECT * FROM system.t1;
ERROR HY000: [DuckDB] Binder Error: Ambiguous reference to catalog or schema "system" - use a fully qualified path like "duckdb.system".
UPDATE system.t1 SET b = 1;
ERROR HY000: [DuckDB] Binder Error: Ambiguous reference to catalog or schema "system" - use a fully qualified path like "duckdb.system".
DELETE FROM system.t1;
ERROR HY000: [DuckDB] Binder Error: Ambiguous reference to catalog or schema "system" - use a fully qualified path like "duckdb.system".
USE `system`;
DROP TABLE t1;
CREATE DATABASE `d``b`;
ERROR HY000: [DuckDB] Incorrect database name d`b for DuckDB..
#
# CLEANUP
#
SET GLOBAL duckdb_dml_in_batch = default;
DROP DATABASE `temp`;
DROP DATABASE `system`;
CALL dbms_duckdb.query("SELECT * FROM information_schema.schemata WHERE catalog_name in (\"system\", \"temp\") or schema_name in (\"system\", \"temp\")");
RESULT
catalog_name	schema_name	schema_owner	default_character_set_catalog	default_character_set_schema	default_character_set_name	sql_path	
VARCHAR	VARCHAR	VARCHAR	VARCHAR	VARCHAR	VARCHAR	VARCHAR	
[ Rows: 4]
system	information_schema	duckdb	NULL	NULL	NULL	NULL
system	main	duckdb	NULL	NULL	NULL	NULL
system	pg_catalog	duckdb	NULL	NULL	NULL	NULL
temp	main	duckdb	NULL	NULL	NULL	NULL


