include/master-slave.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the connection metadata repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
[connection master]
###########################################################################
# 0. Prepare
###########################################################################
[connection master]
CREATE TABLE t1 (
id BIGINT NOT NULL,
c0 VARCHAR(20) NOT NULL,
c1 CHAR(10) DEFAULT 'duckdb',
PRIMARY KEY(id, c0)
) ENGINE=InnoDB;
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` bigint NOT NULL,
  `c0` varchar(20) NOT NULL,
  `c1` char(10) DEFAULT 'duckdb',
  PRIMARY KEY (`id`,`c0`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
include/rpl_sync.inc
[connection slave]
ALTER TABLE t1 ENGINE=DuckDB;
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` bigint NOT NULL,
  `c0` varchar(20) NOT NULL,
  `c1` char(10) DEFAULT 'duckdb',
  PRIMARY KEY (`id`,`c0`)
) ENGINE=DUCKDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
include/stop_slave_sql.inc
###########################################################################
# 1. Test DDL implicit commit DuckDB batch
###########################################################################
[connection master]
SET autocommit = 1;
INSERT INTO t1 (id, c0, c1) VALUES (1, 'abc', 'RDS'), (2, 'd', NULL), (3, 'efg', 'MySQL');
UPDATE t1 SET c1='alisql' WHERE id=3;
SET gtid_next = 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:6';
BEGIN;
COMMIT;
SET gtid_next = 'AUTOMATIC';
UPDATE t1 SET id=6 WHERE id=1;
DELETE FROM t1 WHERE id=2;
ALTER TABLE t1 ADD COLUMN c2 DECIMAL(5,2);
INSERT INTO t1 (id, c0, c1, c2) VALUES (4, 'hijk', NULL, 10.5), (5, 'lmn', 'RSA', 7.7);
UPDATE t1 SET c2=8.88 WHERE id=6;
DELETE FROM t1 WHERE id=5;
UPDATE t1 SET c0='mysql' WHERE id=4;
ALTER TABLE t1 ADD COLUMN c3 INT DEFAULT 5;
include/rpl_sync.inc
[connection slave]
include/start_slave_sql.inc
include/rpl_sync.inc
include/rpl_diff.inc
###########################################################################
# 2. Test transactions are not replayed by executing SQL
###########################################################################
include/assert_grep.inc [Check DML SQL is not executed]
include/assert_grep.inc [Check there are 2 commits due to DDL]
include/assert_grep.inc [Check there are 0 commit due to non-Row]
###########################################################################
# 6. Test Cleanup
###########################################################################
[connection master]
DROP TABLE t1;
include/rpl_sync.inc
include/rpl_end.inc
